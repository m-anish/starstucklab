---
// SPDX-License-Identifier: DWYWBDBM-1.0
// site/src/components/ProductCard.astro
// This component now uses the parchment design system
const { product } = Astro.props;
const slug = product?.slug ?? '';
const title = product?.title ?? slug;
const excerpt = product?.excerpt ?? '';
const price = product?.price ? `${product.currency ?? 'USD'} ${product.price}` : null;
const isGenerated = product?.id ? true : false;

// Image paths: public/assets/product-<slug>/product-<slug>-<variant>.webp
const thumbPath = `/assets/product-${slug}/product-${slug}-thumb.webp`;
const masterFallback = `/assets/product-${slug}/product-${slug}-master.png`;
---
<a class="product-card" href={`/shop/${slug}`} aria-label={`View ${title}`}>
  <article class="parchment parchment--compact product-polaroid">
    <div class="product-thumb">
      <img 
        src={thumbPath} 
        alt={title} 
        loading="lazy" 
        onerror={`this.onerror=null;this.src='${masterFallback}'`}
      />
    </div>
    
    <div class="product-meta">
      <h3 class="product-title">{title}</h3>
      {price && <div class="product-price">{price}</div>}
      {excerpt && <p class="product-excerpt">{excerpt}</p>}
      {isGenerated && <div class="badge-generated">âœ¦ generated</div>}
    </div>
  </article>
</a>

<style>
/* Component-specific styles that extend the parchment base */

.product-card {
  display: block;
  text-decoration: none;
  color: inherit;
  width: 100%;
  max-width: 280px;
  transition: transform var(--transition-base, 0.25s ease);
}

.product-card:hover {
  transform: translateY(-4px);
}

.product-polaroid {
  transition: box-shadow var(--transition-base, 0.25s ease);
}

.product-card:hover .product-polaroid {
  box-shadow: 0 16px 48px rgba(6, 6, 6, 0.38);
}

.product-thumb {
  overflow: hidden;
  border-radius: var(--radius-md, 6px);
  background: #f5f5f5;
  margin-bottom: var(--space-3, 12px);
}

.product-thumb img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  display: block;
  transition: transform var(--transition-base, 0.25s ease);
}

.product-card:hover .product-thumb img {
  transform: scale(1.05);
}

.product-title {
  font-family: var(--font-display, 'Playfair Display', serif);
  font-weight: var(--weight-bold, 700);
  font-size: var(--text-base, 1rem);
  margin: 0 0 var(--space-2, 8px) 0;
  color: var(--ink-dark, #28160b);
  line-height: var(--leading-snug, 1.3);
}

.product-price {
  font-weight: var(--weight-semibold, 600);
  color: var(--accent-green, #2a7a4f);
  margin-bottom: var(--space-2, 8px);
  font-size: var(--text-sm, 0.95rem);
  font-family: var(--font-ui, 'Space Grotesk', system-ui, sans-serif);
}

.product-excerpt {
  font-family: var(--font-body, 'Merriweather', Georgia, serif);
  font-size: var(--text-sm, 0.88rem);
  color: var(--ink-mid, #2b1f18);
  line-height: var(--leading-normal, 1.4);
  margin: 0 0 var(--space-2, 6px) 0;
  min-height: 2.8em;
}

.badge-generated {
  margin-top: var(--space-2, 8px);
  font-size: var(--text-xs, 0.8rem);
  color: #888;
  font-style: italic;
  font-family: var(--font-body, 'Merriweather', Georgia, serif);
}

@media (max-width: 820px) {
  .product-card {
    max-width: 100%;
  }
  
  .product-thumb img {
    height: 160px;
  }
  
  .product-title {
    font-size: 0.95rem;
  }
}
</style>